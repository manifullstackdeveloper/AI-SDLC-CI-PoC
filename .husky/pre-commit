#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit validation..."
echo "  - ESLint (code quality)"
echo "  - Prettier (formatting)"
echo "  - Semgrep (security patterns)"
echo "  - Jest (related tests)"
echo ""

# Run lint-staged for staged files (handles linting, formatting, Semgrep, and related tests)
npx lint-staged

# Check exit code - lint-staged will exit with non-zero if any command fails
EXIT_CODE=$?
if [ $EXIT_CODE -ne 0 ]; then
  echo ""
  echo "âŒ Pre-commit validation failed. Generating report..."
  npm run report || true
  echo ""
  echo "ğŸ“Š Report generated: reports/validation-report.html"
  echo "âŒ Pre-commit validation failed. Fix errors and try again."
  exit $EXIT_CODE
fi

echo ""
echo "âœ… Pre-commit validation passed!"

